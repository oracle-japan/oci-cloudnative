version: 0.1
component: build
timeoutInSeconds: 10000
runAs: root
shell: bash
env:
  vaultVariables:
    - OCI_REGISTRY_USERNAME: ocid1.vaultsecret.oc1.us-sanjose-1.amaaaaaassl65iqaxjzdtrtdk2s6dkq43p3iihiukmv6hchmf5vmy357cnjq
    - OCI_REGISTRY_PASSWORD: ocid1.vaultsecret.oc1.us-sanjose-1.amaaaaaassl65iqaq5imtkgwgvtnl37enofiqfp7vlcmzxmzqylj65rjidsa

steps:
  - type: Command
    name: "Helm Package"
    command: |
      helm package deploy/complete/helm-chart/mushop/
    onFailure:
      - type: Command
        command: |
          echo "Handling Failure"
          echo "Failure successfully handled"
        runAs: root
  - type: Command
    name: "Helm Registry Login"
    command: |
      helm registry login sjc.ocir.io -u $OCI_REGISTRY_USERNAME -p $OCI_REGISTRY_PASSWORD
    onFailure:
      - type: Command
        command: |
          echo "Failured helm registry login"
        runAs: root
  - type: Command
    name: "Helm Push"
    command: |
      helm push mushop-0.2.1.tgz sjc.ocir.io/orasejapan/mushop/mushop
    onFailure:
      - type: Command
        command: |
          echo "Failured helm push"
        runAs: root